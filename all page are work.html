<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flipkart Style - Connected Frontend</title>
  <style>
    :root{ --brand:#2874f0; --accent:#fb641b; --bg:#f1f3f6; --text:#212121; --muted:#878787; --card:#fff; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; color:var(--text); background:var(--bg); }
    a{color:inherit;text-decoration:none}
    .hidden{display:none}

    /* Top Header */
    .topbar{ background:var(--brand); color:#fff; position:sticky; top:0; z-index:10; box-shadow:0 2px 8px rgba(0,0,0,.1); }
    .wrap{ max-width:1200px; margin:auto; padding:0 16px }
    .header{ display:flex; align-items:center; gap:12px; padding:10px 0; }
    .logo{ font-weight:800; font-size:20px; letter-spacing:.3px; display:flex; align-items:center; gap:6px; }
    .logo .spark{font-size:18px}
    .search{ flex:1; display:flex; align-items:center; gap:8px; background:#fff; border-radius:8px; padding:6px 10px; }
    .search input{ border:0; outline:0; flex:1; font-size:14px; }
    .search button{ border:0; background:var(--accent); color:#fff; padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:600; }
    .actions{ display:flex; align-items:center; gap:12px }
    .btn{ background:#fff; color:var(--brand); border:0; padding:8px 12px; border-radius:6px; font-weight:600; cursor:pointer }
    .cart{ display:flex; align-items:center; gap:6px }
    .badge{ background:#ff6161; color:#fff; font-size:12px; padding:2px 6px; border-radius:999px }

    /* Category Bar */
    .cats{ background:#fff; border-bottom:1px solid #e5e7eb }
    .catrow{ display:flex; gap:18px; overflow:auto; padding:10px 0 }
    .catrow a{ white-space:nowrap; color:var(--muted); font-weight:600 }
    .catrow a:hover{ color:var(--text) }

    /* Banner */
    .banner{ background:#e3f2ff }
    .banner .hero{ display:grid; grid-template-columns:1.2fr .8fr; gap:16px; align-items:center; padding:18px 0 }
    .hero h1{ margin:0; font-size:28px }
    .hero p{ margin:8px 0 16px; color:var(--muted) }
    .hero img{ width:100%; border-radius:12px }
    .cta{ background:var(--accent); color:#fff; padding:10px 14px; border:0; border-radius:8px; font-weight:700; cursor:pointer }

    /* Product grids */
    .section{ margin:20px 0 }
    .section h2{ margin:0 0 12px 0; font-size:20px }
    .grid{ display:grid; grid-template-columns:repeat(6,1fr); gap:12px }
    @media (max-width:1024px){ .grid{ grid-template-columns:repeat(4,1fr) } }
    @media (max-width:640px){ .grid{ grid-template-columns:repeat(2,1fr) } .banner .hero{ grid-template-columns:1fr } }

    .card{ background:var(--card); border-radius:12px; padding:10px; box-shadow:0 2px 8px rgba(0,0,0,.06); display:flex; flex-direction:column; gap:8px; transition:transform .15s ease, box-shadow .15s ease }
    .card:hover{ transform:translateY(-3px); box-shadow:0 6px 18px rgba(0,0,0,.12) }
    .card img{ width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:8px; background:#f8fafc }
    .title{ font-size:14px; line-height:1.3; min-height:36px }
    .price{ font-weight:800 }
    .strike{ color:var(--muted); text-decoration:line-through; font-weight:500; margin-left:6px }
    .off{ color:#138808; font-weight:700; margin-left:6px }
    .add{ margin-top:auto; border:0; background:var(--brand); color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700 }

    /* Footer */
    footer{ background:#0c2a63; color:#cbd5e1; margin-top:30px }
    .footergrid{ display:grid; grid-template-columns:repeat(4,1fr); gap:16px; padding:22px 0 }
    .footergrid h4{ margin:0 0 8px 0; color:#fff }
    .small{ color:#9ca3af; font-size:12px }
    @media(max-width:800px){ .footergrid{ grid-template-columns:1fr 1fr } }

    /* Modal */
    .modal{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.5); padding:16px }
    .sheet{ width:min(420px,95vw); background:#fff; border-radius:14px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25) }
    .sheet h3{ margin:0 0 8px }
    .sheet label{ display:block; font-size:13px; color:#555; margin-top:8px }
    .sheet input{ width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb; margin-top:6px }
    .row{ display:flex; gap:8px; margin-top:12px }
    .sheet button{ padding:10px 12px; border:0; border-radius:8px; cursor:pointer; font-weight:700 }
    .primary{ background:var(--brand); color:#fff }
    .ghost{ background:#f1f5f9 }
    .note{ font-size:12px; color:#64748b; margin-top:8px }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="wrap header">
      <div class="logo" aria-label="Flipkart style logo">
        <span class="spark">âš¡</span> Flipkart <span style="font-weight:500">Clone</span>
      </div>

      <form class="search" onsubmit="event.preventDefault(); doSearch();">
        <input id="q" type="search" placeholder="Search for products, brands and more" aria-label="Search" />
        <button type="submit">Search</button>
      </form>

      <div class="actions">
        <button id="loginBtn" class="btn">Login</button>
        <button id="logoutBtn" class="btn hidden">Logout</button>
        <a class="cart" href="#" id="openCart">
          ðŸ›’ Cart <span class="badge" id="cartCount">0</span>
        </a>
      </div>
    </div>

    <div class="wrap cats">
      <div class="catrow">
        <a href="#">Electronics</a>
        <a href="#">Mobiles</a>
        <a href="#">Fashion</a>
        <a href="#">Home</a>
        <a href="#">Appliances</a>
        <a href="#">Beauty</a>
        <a href="#">Two Wheelers</a>
        <a href="#">Furniture</a>
        <a href="#">Grocery</a>
      </div>
    </div>
  </div>

  <!-- Banner -->
  <div class="banner">
    <div class="wrap hero">
      <div>
        <h1>Big Savings on Top Deals</h1>
        <p>Up to 60% off on mobiles, electronics, fashion and more. Free delivery on your first order.</p>
        <button class="cta" onclick="scrollToDeals()">Shop Deals</button>
      </div>
      <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=1200&auto=format&fit=crop" alt="Promo banner"/>
    </div>
  </div>

  <!-- Sections -->
  <main class="wrap">
    <section class="section" id="deals">
      <h2>Top Offers</h2>
      <div class="grid" id="grid"><!-- Product Cards will render here --></div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="wrap footergrid">
      <div>
        <h4>About</h4>
        <div class="small">Flipkart-style layout using plain HTML, CSS & JS, connected to a Node/Express API.</div>
      </div>
      <div>
        <h4>Help</h4>
        <div class="small">Payments â€¢ Shipping â€¢ Cancellation â€¢ FAQ</div>
      </div>
      <div>
        <h4>Policy</h4>
        <div class="small">Return Policy â€¢ Terms of Use â€¢ Security â€¢ Privacy</div>
      </div>
      <div>
        <h4>Social</h4>
        <div class="small">YouTube â€¢ Instagram â€¢ Twitter</div>
      </div>
    </div>
  </footer>

  <!-- Auth Modal -->
  <div id="authModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="sheet">
      <h3 id="authTitle">Login / Signup</h3>
      <label>Name (for signup)
        <input id="name" placeholder="Your name" />
      </label>
      <label>Email
        <input id="email" placeholder="you@example.com" />
      </label>
      <label>Password
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      </label>
      <div class="row">
        <button class="primary" onclick="signup()">Signup</button>
        <button class="ghost" onclick="login()">Login</button>
        <button class="ghost" onclick="closeAuth()">Close</button>
      </div>
      <div class="note">Token is stored locally for API requests.</div>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const API_BASE = 'http://localhost:5000/api'; // Change if your backend URL is different

    // ====== STATE ======
    let token = localStorage.getItem('token') || null;
    let userId = localStorage.getItem('userId') || null;

    // ====== UI HELPERS ======
    const $ = (sel) => document.querySelector(sel);
    const grid = $('#grid');
    const cartCountEl = $('#cartCount');
    const loginBtn = $('#loginBtn');
    const logoutBtn = $('#logoutBtn');
    const authModal = $('#authModal');

    function toast(msg){
      let box = document.getElementById('toastBox');
      if(!box){
        box = document.createElement('div'); box.id='toastBox';
        Object.assign(box.style,{position:'fixed',bottom:'20px',left:'50%',transform:'translateX(-50%)',padding:'10px 14px',background:'#111',color:'#fff',borderRadius:'8px',fontWeight:'700',opacity:0,transition:'opacity .2s, transform .2s',zIndex:50});
        document.body.appendChild(box);
      }
      box.textContent = msg; box.style.opacity=1; box.style.transform='translateX(-50%) translateY(0)';
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{ box.style.opacity=0; box.style.transform='translateX(-50%) translateY(10px)' },1400);
    }

    function openAuth(){ authModal.classList.remove('hidden'); }
    function closeAuth(){ authModal.classList.add('hidden'); }

    loginBtn.addEventListener('click', openAuth);
    logoutBtn.addEventListener('click', ()=>{ localStorage.removeItem('token'); localStorage.removeItem('userId'); token=null; userId=null; applyAuthUI(); toast('Logged out'); });

    function applyAuthUI(){
      if(token){ loginBtn.classList.add('hidden'); logoutBtn.classList.remove('hidden'); }
      else { loginBtn.classList.remove('hidden'); logoutBtn.classList.add('hidden'); }
    }

    // ====== API HELPERS ======
    async function api(path, {method='GET', body, auth=false}={}){
      const headers = { 'Content-Type':'application/json' };
      if(auth && token){ headers['Authorization'] = `Bearer ${token}`; }
      const res = await fetch(`${API_BASE}${path}`, { method, headers, body: body?JSON.stringify(body):undefined });
      if(!res.ok){
        const text = await res.text();
        throw new Error(text || `HTTP ${res.status}`);
      }
      try { return await res.json(); } catch{ return {}; }
    }

    // ====== AUTH ======
    async function signup(){
      const name = $('#name').value.trim();
      const email = $('#email').value.trim();
      const password = $('#password').value.trim();
      if(!name || !email || !password) return toast('Fill all fields');
      try {
        await api('/auth/signup', {method:'POST', body:{name,email,password}});
        toast('Signup success, now login');
      } catch(e){ toast(e.message); }
    }

    async function login(){
      const email = $('#email').value.trim();
      const password = $('#password').value.trim();
      if(!email || !password) return toast('Enter email & password');
      try {
        const data = await api('/auth/login', {method:'POST', body:{email,password}});
        token = data.token; localStorage.setItem('token', token);
        // Decode user id from token (simple parse): backend returns id in payload; for demo we fetch profile-less and rely on cart calls requiring userId typed by user if null.
        // Better: create an endpoint /auth/me; for now we ask backend to return userId too (optional). If not present, keep it cached after first cart call response.
        if(data.userId){ userId = data.userId; localStorage.setItem('userId', userId); }
        applyAuthUI(); closeAuth(); toast('Logged in');
      } catch(e){ toast(e.message); }
    }

    // ====== PRODUCTS ======
    async function loadProducts(){
      try {
        const products = await api('/products');
        grid.innerHTML = products.map(p => `
          <article class="card">
            <img src="${p.img}" alt="${p.title}"/>
            <div class="title">${p.title}</div>
            <div><span class="price">â‚¹${p.price?.toLocaleString?.('en-IN') ?? p.price}</span>
                 ${p.mrp?`<span class="strike">â‚¹${p.mrp}</span>`:''}
                 ${p.off?`<span class="off">${p.off}</span>`:''}
            </div>
            <button class="add" onclick="addToCart('${p._id}','${(p.title||'Item').replace(/'/g, "\\'")}')">Add to Cart</button>
          </article>`).join('');
      } catch(e){
        grid.innerHTML = '<div class="small">Failed to load products. Is backend running?</div>';
      }
    }

    // ====== CART ======
    async function ensureUser(){
      if(userId) return true;
      const id = prompt('Enter your userId (from database) to use cart, or cancel');
      if(id){ userId = id; localStorage.setItem('userId', userId); return true; }
      return false;
    }

    async function refreshCartCount(){
      if(!userId) { cartCountEl.textContent = '0'; return; }
      try {
        const cart = await api(`/cart/${userId}`);
        const count = (cart?.items||[]).reduce((n,i)=> n + (i.quantity||0), 0);
        cartCountEl.textContent = count;
      } catch{ cartCountEl.textContent = '0'; }
    }

    async function addToCart(productId, title){
      if(!token){ toast('Please login first'); openAuth(); return; }
      if(!await ensureUser()) return;
      try {
        await api('/cart/add', {method:'POST', body:{ userId, productId }, auth:true});
        toast(`${title} added to cart`);
        refreshCartCount();
      } catch(e){ toast(e.message); }
    }

    // ====== SEARCH ======
    function doSearch(){ const q = document.getElementById('q').value.trim(); if(q) toast(`Searching for: ${q}`); }
    function scrollToDeals(){ document.getElementById('deals').scrollIntoView({behavior:'smooth'}); }

    // ====== INIT ======
    (async function init(){
      applyAuthUI();
      await loadProducts();
      await refreshCartCount();
    })();
  </script>
</body>
</html>